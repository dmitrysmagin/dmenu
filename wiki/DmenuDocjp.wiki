#labels Phase-Deploy,Phase-Support
= dmenu解説書 =

　この解説書は、自力でdmenu（dmenu-0.4-r48以前）に関するcfgファイルを書きたい方への支援として作成しました。

　cfgファイルの記述方法が理解できると、dmenuはかなり細かなカスタマイズが可能になります。

== ■注意事項 ==

　お手元のdmenuに関するcfgファイルと見比べながら読んでもらうと、比較的簡単に理解できるかもしれません。

　各cfgファイルを修正した後に、Segmentation faultエラーが発生してdmenuが起動しなくなることがありますが、そういう場合はたいてい、「{」と「｝」の数が合っていない（{と}で正しくセグメント分けできていない）可能性が高いです。そのあたりを中心によく確認してみましょう。

== ■フォルダ構造 ==

SDカード:local/<br>
├home/.dmenu/　　　　　　←dmenu用リソース<br>
│├STATspeaker.png　　　←スピーカアイコン<br>
│├STATbright0.png　　　 ←輝度アイコン(Level0)<br>
│├STATbright1.png　　　 ←輝度アイコン(Level1)<br>
│├STATbright2.png　　　 ←輝度アイコン(Level2)<br>
│├STATbright3.png　　　 ←輝度アイコン(Level3)<br>
│├STATbright4.png　　　 ←輝度アイコン(Level4)<br>
│├sound_volume.ini　　　←音量設定保存ファイル<br>
│├brightness_level.ini 　←輝度設定保存ファイル<br>
├dmenu/<br>
│├dmenu　　　　　　　　 ←プログラム本体<br>
│├main.cfg<br>
│├themes/　　　　　　　←配下のフォルダ名をtheme.cfgで指定する<br>
│├┬(テーマ名1)/<br>
││├theme.cfg<br>
││├インクルードファイル.cfg<br>
││└res/<br>
│├┬(テーマ名2)/<br>
││├theme.cfg<br>
││├インクルードファイル.cfg<br>
││└res/<br>
│├┬(テーマ名3)/<br>
││├theme.cfg<br>
││├インクルードファイル.cfg<br>
││└res/<br>
│:<br>
│:<br>
└(SearchPath)/　　　　 ←相対パス指定の場合はdmenu以下の指定<br>
　├sample_dir1/　　　　　ディレクトリを探す。フルパス指定可。<br>
　│└dmenu.cfg　　　　 ←SearchPath配下のディレクトリ内にある<br>
　└sample_dir2/　　　　　dmenu.cfgを探して読み込む。<br>
　　└sample_dir3/<br>
　　　└dmenu.cfg　　　 ←階層が深くても可。<br>

== ■各cfgファイルの役割と書式 ==

=== ●main.cfg ===

==== ○役割 ====

　dmenuのテーマ(スキン)、dmenu.cfg(後述)を探すフォルダ、テーマの変更を許可するかどうかの設定を行う。

==== ○書式 ====

*Theme = "使用するテーマフォルダのフォルダ名"

　dmenuで使用するテーマフォルダのフォルダ名を指定する。Theme = "test" と記述した場合、local/dmenu/themes/testフォルダのテーマを使用する。

*SearchPath = {"探索先フォルダ1","探索先フォルダ2"}

　dmenuプログラムは、SearchPathに指定されたフォルダ配下の各フォルダから"dmenu.cfg"ファイルを探し、自動的にtheme.cfgファイルに組み込んでメニュー等を構築する。ダブルクォーテーション（ " )で囲んだファイルパスをカンマ(,)で連結することにより、複数の探索先フォルダを指定できる。

　フルパス（"/usr/local/～～～）でも相対パス（～～～）でも指定できるが、相対パスで指定した場合は、dmenuフォルダ以下の～～～ディレクトリが探索対象となる。

*AllowDynamicThemeChange = true

　この記述を行うことにより、dmenu実行中にテーマを選択、切り替えることができるようになる。

=== ●theme.cfg ===

==== ○役割 ====

　dmenuで表示されるメニューの構造や外見を設定するファイル。基本的には、後述するinclude.cfg/dmenu.cfgを利用せずとも、全てをこのファイルに記述することで設定が可能。

　自国語フォントを用いてメニューやファイル名の自国語表記を行いたい場合は、cfgファイル保存時の文字コードに「UTF-8N」を選択すること。

==== ○コマンドと書式 ====

　　※★マークの記述は必須。

*★Background = "画像ファイル(png)"

　メイン画面の背景画像を指定する。

　背景画像サイズは320x240の24bitカラーまで問題ないことを確認。ファイルパスは、cfgファイルが存在しているフォルダからの相対パスか、フルパスで指定する。

*★Cursor = "画像ファイル(png)"

　カーソル画像を指定する。

　ファイルパスは、cfgファイルが存在しているフォルダからの相対パスか、フルパスで指定する。

*★Font = "フォントファイル(ttf)"

　メニューの文字に使われるフォントファイルを指定する。

　日本語フォントを指定すれば、メニューやファイル名表示に日本語を使うことができる。

　ファイルパスは、cfgファイルが存在しているフォルダからの相対パスか、フルパスで指定する。

*★ListBackground = "画像ファイル(png)"

　ファイルリスト表示時の背景画像を指定する。背景画像サイズは320x240の24bitカラーまで問題ないことを確認。

　ファイルパスは、cfgファイルが存在しているフォルダからの相対パスか、フルパスで指定する。

*★ListSelector = "画像ファイル(png)"

　ファイルリスト画面でのファイル選択カーソル画像を指定する。

　ファイルパスは、cfgファイルが存在しているフォルダからの相対パスか、フルパスで指定する。

*★ListDirIcon = "画像ファイル(png)"

　ファイルリスト表示時の、ディレクトリを示すアイコン画像を指定する。

　ファイルパスは、cfgファイルが存在しているフォルダからの相対パスか、フルパスで指定する。

*★ListFileIcon = "画像ファイル(png)"

　ファイルリスト表示時の、ファイルを示すアイコン画像を指定する。

　ファイルパスは、cfgファイルが存在しているフォルダからの相対パスか、フルパスで指定する。

*FontColor-R ="文字色の赤成分の強さ(0～255)"

　menu画面やfilelist画面で表示される文字色の赤成分の強さを指定する。

*FontColor-G ="文字色の緑成分の強さ(0～255)"

　menu画面やfilelist画面で表示される文字色の緑成分の強さを指定する。

*FontColor-B ="文字色の青成分の強さ(0～255)"

　menu画面やfilelist画面で表示される文字色の青成分の強さを指定する。

*MenuSE = "音源ファイル(wav or ogg)"

　メニューを左右にスクロールさせた際のキー音を指定する。

　ファイルパスは、cfgファイルが存在しているフォルダからの相対パスか、フルパスで指定する。

*MenuItemSE = "音源ファイル(wav or ogg)"

　メニューを上下にスクロールさせた際のキー音を指定する。

　ファイルパスは、cfgファイルが存在しているフォルダからの相対パスか、フルパスで指定する。

*DecideSE = "音源ファイル(wav or ogg)"

　サブメニューを開く/ファイルリストでフォルダに入る際のキー音を指定する。

　ファイルパスは、cfgファイルが存在しているフォルダからの相対パスか、フルパスで指定する。

*CancelSE = "音源ファイル(wav or ogg)"

　サブメニューを閉じる/ファイルリストでフォルダから出る際のキー音を指定する。

　ファイルパスは、cfgファイルが存在しているフォルダからの相対パスか、フルパスで指定する。

*OutSE = "音源ファイル(wav or ogg)"

　サブメニューを開いた状態で左右を押すなど、操作不可であることを知らせる際のキー音を指定する。

　ファイルパスは、cfgファイルが存在しているフォルダからの相対パスか、フルパスで指定する。

*TestSE = "音源ファイル(wav or ogg)"

　音量や輝度を設定する際のキー音を指定する。

　ファイルパスは、cfgファイルが存在しているフォルダからの相対パスか、フルパスで指定する。

*include("インクルードファイル.cfg")

　インクルードファイル.cfgをtheme.cfgのこの記述がある場所に取り込む。

　ファイルパスは、cfgファイルが存在しているフォルダからの相対パスか、フルパスで指定する。

*Menu [メニュー名]

　横並びになるメニュー項目を定義する。

　メニュー名はdmenuの内部処理で用いられる名称で、半角のアルファベット+数字で命名する。

　"{"と"}"で囲まれたセクションに、下記のMenuItem定義などを列挙することで、[メニュー名]の項目内容を定義する。

*MenuItem [メニューアイテム名]

　縦に並ぶメニュー内容の項目を定義する。

　メニューアイテム名はdmenuの内部処理で用いられる名称で、半角のアルファベット+数字で命名する。

　"{"と"}"で囲まれたセクションに、下記のSubMenuItem定義などを列挙することで、[メニューアイテム名]の項目内容を定義する。

*SubMenuItem [サブメニューアイテム名]

　メニューアイテムをAボタンで選択した際に、表示させるサブメニューのアイテム項目を定義する。この記述は「MenuItem」セクション内でのみ有効で、MenuセクションやSubMenuItemセクション内では意味を持たない。

　サブメニューアイテム名はdmenuの内部処理で用いられる名称で、半角のアルファベット+数字で命名する。

　"{"と"}"で囲まれたセクションに、下記のIconやName等の定義を列挙することで、[サブメニューアイテム名]の項目内容を定義する。

*Icon = "画像ファイル(png)"

　メニュー、メニューアイテム、サブメニューアイテムのアイコンとして表示させる画像を指定する。

　ファイルパスは、cfgファイルが存在しているフォルダからの相対パスか、フルパスで指定する。

*Name = "メニューアイテム等の名前として画面に表示する文字"

　メニュー、メニューアイテム、サブメニューアイテムを画面に表示させた際の、アイコンのキャプションとして表示される文字列を指定する。

　フォント設定で自国語フォントを指定してあれば、この文字列に自国語を使うことができる。

*Executable = "実行ファイル"

　メニューアイテム、サブメニューアイテムを選択された場合に実行されるプログラムのファイル名を記述する。

　ファイルパスは、cfgファイルが存在しているフォルダからの相対パスか、フルパスで指定する。

*WorkDir = "実行ファイルを実行する際のカレントフォルダ"

　メニューアイテム、サブメニューアイテムからプログラムを実行する際に、どのフォルダから実行するか(カレントフォルダ)を指定する。

　ファイルパスは、cfgファイルが存在しているフォルダからの相対パスか、フルパスで指定する。

*Selector = yes

　この記述がある場合、メニューアイテムやサブメニューアイテムを選択されると、ファイル一覧表示モードへ移行する。ファイル一覧表示モードで選択されたファイルが"Executable"で指定されたプログラムに渡される。

　ROMファイル名をエミュレータプログラムに渡したり、テキストファイル名をテキストリーダプログラムに渡したりする場合に用いる。

=== ●インクルードファイル.cfg（ファイル名は自由） ===

==== ○役割 ====

　dmenuのメニュー構造や外見を設定するファイル。　拡張子(.cfg)を除くファイル名が自由に設定できるため、メニュー項目ごとに分割したりまとめておくことで、メニュー構造全体の把握がしやすくなる。

　例）menu_system.cfg / menu_game.cfg など

　自国語フォントを用いてメニューやファイル名の自国語表記を行いたい場合は、cfgファイル保存時の文字コードに「UTF-8N」を選択すること。

==== ○コマンドと書式 ====

*使用可能なコマンド

　Menu<br>
　　MenuItem<br>
　　MenuItemセクション内での<br>
　　　SubMenuItem<br>
　　　　Icon<br>
　　　　Name<br>
　　　　Executable<br>
　　　　WorkDir<br>
　　　　Selector<br>

※他のコマンドも使用可能と思われるが、記述内容の優先度はプログラムがcfgファイルを読み込む順番に左右されるため、推奨しない。(後から読み込まれたものが優先されるため、重複した記述が上書きされるなど、cfgファイルの作成ミスに気づきにくくなる。）

*書式はtheme.cfgに準じる。

=== ●dmenu.cfg ===

==== ○役割 ====

　dmenuのメニュー構造や外見を設定するファイル。main.cfgで指定された「探索先フォルダ」以下に配置しておくと、自動的にtheme.cfgに取り込まれる。新たにアプリケーションを配布する際に、あらかじめ dmenu.cfg ファイルも同梱しておくと、ユーザはmain.cfgで指定された「探索先フォルダ」にアプリケーションとdmenu.cfgの入ったフォルダをコピーするだけで、自動的にdmenuのメニュー項目として組み込まれる。

　例）<br>
　　emulators/		←main.cfgで探索先フォルダに指定しておく<br>
　　├mame4all/<br>
　　│└dmenu.cfg	←mame4all起動に関するメニュー項目を記述<br>
　　├snes9x/<br>
　　│└dmenu.cfg	←snes9x起動に関するメニュー項目を記述<br>
　　└picodrive/<br>
　　　└dmenu.cfg	←picodrive起動に関するメニュー項目を記述

　自国語フォントを用いてメニューやファイル名の自国語表記を行いたい場合は、cfgファイル保存時の文字コードに「UTF-8N」を選択すること。

==== ○コマンドと書式 ====

*使用可能なコマンド

　Menu<br>
　MenuItem<br>
　MenuItemセクション内での<br>
　　Icon<br>
　　Name<br>
　　Executable<br>
　　WorkDir<br>
　　Selector<br>

※他のコマンドも使用可能と思われるが、記述内容の優先度はプログラムがcfgファイルを読み込む順番に左右されるため、推奨しない。(後から読み込まれたものが優先されるため、重複した記述が上書きされるなど、cfgファイルの作成ミスに気づきにくくなる。）

*書式はtheme.cfgに準じる。

----------------------<br>
20091013<br>
1@qbQD4T5Z0949